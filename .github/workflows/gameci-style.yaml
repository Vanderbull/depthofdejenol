name: Qt 6 Production Release

on:
  push:
    branches: [ "main", "develop" ]
    tags: ["v*"] # Professional standard: trigger real releases via tags
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:
  schedule:
    - cron: '0 10 * * 5'

permissions:
  contents: write # Essential for creating releases

jobs:
  build:
    name: Build Game (Ubuntu)
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true # Crucial for game assets

      - name: Install Qt 6 & Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential qmake6 qt6-base-dev qt6-multimedia-dev libgl1-mesa-dev

      - name: Configure and Compile
        run: |
          qmake6
          make -j$(nproc) # Faster builds using all available cores

      # --- NEW: Stage the binary for the release job ---
      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: game-binary
          path: | 
            YOUR_BINARY_NAME
            # Add any assets/folders needed to run the game here

  release:
    needs: build
    # Only create a release if a tag was pushed (e.g., v1.0.1)
    if: startsWith(github.ref, 'refs/tags/')
    runs-on: ubuntu-latest
    
    steps:
      - name: Download Artifact
        uses: actions/download-artifact@v4
        with:
          name: game-binary

      - name: Package Release Assets
        run: tar -czvf game-linux-x64.tar.gz *

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: game-linux-x64.tar.gz
          generate_release_notes: true
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
