name: Qt 6 Build & Compile
          
on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:
          
jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest]
        # Use a specific, stable Qt version for reliability
        qt_version: [6.5.3] 
        # The installer will select the appropriate compiler/kit for Ubuntu
        target_compiler: [gcc_64]

    runs-on: ${{ matrix.os }}
          
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # --- FIXED: Using the official qt-project/setup-qt action for maximum reliability ---
      - name: Install Qt
        uses: qt-project/setup-qt@v1
        with:
          version: ${{ matrix.qt_version }}
          host: 'linux'
          target: 'desktop'
          arch: 'gcc_64'
          # qtbase includes core, gui, and widgets.
          modules: 'qtbase qtmultimedia'

      - name: Configure project using qmake (automatically uses correct qmake path)
        # The setup-qt action ensures the correct qmake is on the PATH.
        run: qmake

      - name: Compile project (Linux/make)
        if: runner.os == 'Linux'
        # The correct Makefile is generated, and 'make' will now succeed
        run: make
