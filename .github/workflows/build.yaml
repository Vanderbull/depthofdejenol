name: Qt 6 Build & Compile
          
on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:
          
jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest]
        # Use a specific, stable Qt version from the matrix for reliability
        qt_version: [6.5.3] 
        # The installer will select the appropriate compiler/kit for Ubuntu
        target_compiler: [gcc_64]

    runs-on: ${{ matrix.os }}
          
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # --- FIX: Use the dedicated setup-qt action for reliable installation ---
      - name: Install Qt
        uses: jurple/setup-qt@v3
        with:
          version: ${{ matrix.qt_version }}
          host: 'linux'
          target: 'desktop'
          arch: 'gcc_64'
          # This command ensures all required modules are downloaded
          modules: 'qtbase qtmultimedia'

      - name: Configure project using qmake (automatically uses correct qmake path)
        # We now run qmake without specifying 'qmake6', as the setup-qt action 
        # ensures the correct qmake is on the PATH for the entire job.
        run: qmake

      - name: Compile project (Linux/make)
        if: runner.os == 'Linux'
        # The correct Makefile is generated, and 'make' will now succeed
        run: make
